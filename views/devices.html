{% extends 'auth_base.html' %} {% block content %}
<script></script>
<!-- Devices sub navigation -->
<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <button
      class="nav-link active"
      id="pills-profile-tab"
      data-bs-toggle="pill"
      data-bs-target="#pills-devices"
      type="button"
      role="tab"
      aria-controls="pills-devices"
      aria-selected="false"
    >
      My Devices
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button
      class="nav-link secondary"
      id="pills-contact-tab"
      data-bs-toggle="pill"
      data-bs-target="#pills-add-devices"
      type="button"
      role="tab"
      aria-controls="pills-add-devices"
      aria-selected="false"
    >
      Add Devices
    </button>
  </li>
</ul>
<div class="tab-content" id="pills-tabContent">
  <!-- Tab my devices -->
  <div
    class="tab-pane fade show active"
    id="pills-devices"
    role="tabpanel"
    aria-labelledby="pills-devices-tab"
  >
    <!-- Tab content -->
    <div class="container-fluid px-0">
      <table class="table table-hover">
        <tr>
          <th>Device name</th>
          <th>Power consumption</th>
          <th>Last modified</th>
          <th>Status</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
        {% for device in device_list %}
        <tr>
          <td><a href="devices/device_detail/{{device._id}}">{{device.name}}</a></td>
          <td>{{device.power}} W</td>
          <td></td>
          {% if device.state == "ON" %}
            <td><span class="greendot"></span></td>
          {% else %}
            <td><span class="reddot"></span></td>
          {% endif %}
          <td><a href="devices/edit/{{device._id}}"><i class="bi bi-gear"></i></a></td>
          <td><button class="btn btn-sm" onclick="deleteCheck('{{device._id}}')"><i class="bi bi-trash"></i></button></i></td>
        </tr>
        {% else %}
        {% endfor %}
      </table>
    </div>
  </div>
  <!-- Tab add devices -->
  <div
    class="tab-pane fade"
    id="pills-add-devices"
    role="tabpanel"
    aria-labelledby="pills-add-devices-tab"
  >
    <!-- Tab content -->
    <div class="container-fluid px-0">
      <form action="" method="POST">
        <!-- Device Name field -->
        <div class="form-floating mb-3">
          <input
            type="text"
            name="devicename"
            class="form-control"
            id="floatingInput"
            placeholder="Device Name"
          />
          <label for="floatingInput">Name</label>
        </div>

        <!-- Energy usage field -->
        <div class="form-floating mb-3">
          <input
            type="number"
            name="energyusage"
            class="form-control"
            id="floatingInput"
            placeholder="name@example.com"
          />
          <label for="floatingInput">Energy consumption in watts (W)</label>
        </div>

        <!-- Active times fields-->
        <div class="wrapper mb-3">
          <div class="d-flex justify-content-center mb-1">
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-00"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-00"
              >00:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-01"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-01"
              >01:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-02"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-02"
              >02:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-03"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-03"
              >03:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-04"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-04"
              >04:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-05"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-05"
              >05:00</label
            ><br />
          </div>

          <div class="d-flex justify-content-center mb-1">
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-06"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-06"
              >06:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-07"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-07"
              >07:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-08"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-08"
              >08:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-09"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-09"
              >09:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-10"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-10"
              >10:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-11"
              autocomplete="off"
              
            />
            <label class="btn btn-secondary mx-1" for="btn-check-11"
              >11:00</label
            >
          </div>

          <div class="d-flex justify-content-center mb-1">
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-12"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-12"
              >12:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-13"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-13"
              >13:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-14"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-14"
              >14:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-15"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-15"
              >15:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-16"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-16"
              >16:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-17"
              autocomplete="off"
              
            />
            <label class="btn btn-secondary mx-1" for="btn-check-17"
              >17:00</label
            >
          </div>

          <div class="d-flex justify-content-center mb-1">
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-18"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-18"
              >18:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-19"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-19"
              >19:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-20"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-20"
              >20:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-21"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-21"
              >21:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-22"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-22"
              >22:00</label
            >
            <input
              type="checkbox"
              class="btn-check"
              id="btn-check-23"
              autocomplete="off"
            />
            <label class="btn btn-secondary mx-1" for="btn-check-23"
              >23:00</label
            >
          </div>
        </div>
        <!-- Hidden input to store array of active time slots-->
        <input type="hidden" id="timeslots" name="activeArr" value=""/>
        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary w-25">Add</button>
      </form>
    </div>
  </div>
</div>
{% if errors %}
    <ul>
        {% for error in errors %}
            <li>{{error.msg}}</li>
        {% endfor %}
    </ul>
{% endif %}
<!--Alerts the user if the really want to delete the device-->
<script>

  //Add event listeners to all checkboxes
  document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
    return checkbox.addEventListener("click", () => {
      //Create an array that will contain the index of checked checkboxes
      let activeArr = new Array(24).fill(0);

      //Find all checkbox elements
      let checkboxes = document.querySelectorAll('input[type="checkbox"]');

      //Push the index of a checked checkbox
      for (let i = 0; i < checkboxes.length; i++) {

        if (checkboxes[i]['checked'] === true){
          activeArr[i] = 1;
        }
      };
      
      //Set the hidden input value to the array
      document.getElementById('timeslots').value = activeArr;

    });
  });


  //Confirmation on delete device
  function deleteCheck(id) {
    if (confirm("Are you sure you want to delete this device?")) {
      window.location.replace("/devices/delete/" + id);
    } else {

    }
  }
</script>
{% endblock content %}
