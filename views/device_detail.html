{% extends 'auth_base.html' %} {% block content %}

<!-- Chart.js dependencies -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<body>
  <div class="row mb-3">
    <div class="col-12">
      <div class="card-header">
        <h4>Device information:</h4>
      </div>
      <div class="card-body">
        <table class="table table-hover">
          <tr>
            <th>Device name</th>
            <th>Power consumption</th>
            <th>Status</th>
          </tr>
          <tr>
            <td>{{device.name}}</td>
            <td>{{device.power}} W</td>
            {% if device.state == "ON" %}
              <td><span class="greendot"></span></td>
            {% else %}
              <td><span class="reddot"></span></td>
            {% endif %}
        </table>
      </div>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-12">
      <div class="card-header">
        <h4>Lifetime Energy Consumption:</h4> 
      </div>
      <div class="card-body">
        <h5>{{device.lifetime_energy_consumption.toFixed(3)}} kW</h5>
      </div>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <p class="my-0">Device Energy Consumption Past Day</p>
          </div>
        </div>
        <div class="card-body">
          <canvas id="deviceEnergy"></canvas>
        </div>
      </div>
    </div>
  </div>
</body>

<!-- Displays the energy consumption over 1 day graph-->
<script>

  //Get the energy consumption from device
  let energy_consumption_last_day = "{{device.energy_consumption_last_day}}".split(',');
  console.log(energy_consumption_last_day)

  //Push every five-minute interval beginning from current interval to this array
  let time_labels = [];

  //Get current date
  let date = new Date();

  for (let i=0; i<=288; i++){
    //Format minutes and hours to have leading zero and rounded to five like 00:05
    let f_min = ("0" + (Math.floor(date.getMinutes() / 5) * 5)).slice(-2);
    let f_hour = ("0" + date.getHours()).slice(-2);

    time_labels.push(`${f_hour}:${f_min}`);

    //Increment the date by five minutes
    date.setMinutes(date.getMinutes() + 5);
  }
  time_labels.shift()

  let ctx = document.getElementById("deviceEnergy").getContext("2d");
  let chart = new Chart(ctx, {
    // The type of chart we want to create
    type: "line",
    data: {
      labels: time_labels,
      datasets: [
        {
          label: "Device Energy Consumption",
          borderColor: "rgb(255, 201, 25)",
          fill: false,
          data: energy_consumption_last_day,
          yAxisID: 'y',
        },
      ],
    },
    // Configuration options go here
    options: {
      scales: {
        yAxes: [{
          id: 'y',
          scaleLabel: {
            display: true,
            labelString: 'kWh',
          },
        }]
      },
      elements: {
        point: {
          radius: 0,
          hitRadius: 10,
          hoverRadius: 10,
        },
      },
    },
  });
</script>


{% endblock %}